<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" sizes="16x26" href="./fab_icon.png">
    <title>toBuy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.1/css/font-awesome.css" integrity="sha512-bf5lgyUrZOfPh94XyXFK4+2062lAMQFAfxUTVkOAHZ7R3XQ0tY+TUSkbqt8sjFsq0hVMKvGT/1P39c+vKwesTQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
         body {
            background-color: #f4f7f6;
            font-family: 'Poppins', sans-serif;
        }

        .card {
            /* Light white background with subtle texture */
            background-color: #f7f7f7; /* Light grayish white */
            background-image: url('./bg.jpg'); /* Optional light texture image */
            background-size: 100px 100px; /* Adjust texture size if needed */
            background-size: cover; /* Ensures the image covers the entire background */
            background-position: center; /* Centers the image */
            background-repeat: no-repeat; /* Prevents repeating */
            background-blend-mode: overlay; /* Blend it with the white background */
            font-family: 'Arial', sans-serif;
            color: #333;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .logo {
            max-width: 100%;
            height: auto;
            object-fit: contain; /* Ensures the logo fits within the container without distortion */
        }

        .card-header {
            font-weight: bold;
            font-size: 1.5rem;
            font-family: 'Arial', sans-serif;
            /* background-color: #007bff; */
            color: white;
            /* padding: 15px; */
            text-align: center;
            letter-spacing: 2px;
        }
        
        .container {
            position: relative;
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        #mybutton {
            position: fixed;
            bottom: 20px;  /* Adjusted from 75px to 20px */
            right: 20px;   /* Same distance from the right */
            background-color: #28a745;
            border-radius: 50%;
            padding: 10px; /* Increased padding slightly for better spacing */
            width: 45px;   /* Slightly smaller button */
            height: 45px;  /* Matching height */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }

        #mybutton:hover {
            background-color: #1e7e34;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            transform: translateY(-5px);
        }

    </style>
</head>
<body>

     <div class="card text-center">
        <div class="card-header d-flex justify-content-between align-items-center">
            <!-- Logo Section -->
            <img src="./toBuy.png" alt="Logo" class="logo mx-auto" style="width: 150px; height: auto;">
        
            <!-- Logout Button -->
            <button id="logout" class="btn btn-danger" title="Logout">
                <i class="fa fa-sign-out" aria-hidden="true"></i>
            </button>
        </div> 
        <div class="container">
            <header class="py-3">
                <div class="d-flex justify-content-evenly">
                    <button type="button" onclick="goHome()" class="btn btn-light position-relative">
                        Home
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="total_items_count">
                          0
                        </span>
                      </button>
                      <button type="button"  onclick="goToCompleted()" class="btn btn-primary position-relative">
                        Completed
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success" id="total_completedItem_count">
                         0
                        </span>
                      </button>
                </div>
            </header>
            <!-- Search Box -->
            <div class="row">
                <div class="col-6 offset-3">
                    <input type="text" class="form-control" id="search" placeholder="Search Items">
                </div>
            </div>
            <!-- Table for Completed Items -->
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Items</th>
                    </tr>
                </thead>
                <tbody id="completedItemList">
                    <!-- Completed items will be listed here -->
                </tbody>
            </table>

              <!-- Button to Print the Completed Items -->
            <button class="btn btn-secondary mt-3" onclick="printCompletedItems()"><i class="bi bi-printer"></i></button>
        </div>
    </div>

    <script src="./Auth.js"></script>
    <script>
        function goHome() {
            window.location.href = "./dashboard.html";
        }
        function goToCompleted(){
            window.location.href = "./completed.html";
        }
        function getCompletedItems() {
            let completedItems = localStorage.getItem('completedItems');
            return completedItems ? JSON.parse(completedItems) : [];
        }

        function renderCompletedItems( filter = '') {
            let completedItems = getCompletedItems();
            let completedItemList = document.getElementById('completedItemList');
            completedItemList.innerHTML = '';
            // Filter items based on the search query
            let filteredItems = completedItems.filter(item => item.toLowerCase().includes(filter.toLowerCase()));

            // Display filtered items
            filteredItems.forEach((item, index) => {
                let row = `
                <tr>
                    <th scope="row">${index + 1}</th>
                    <td>${item}</td>
                </tr>`;
                completedItemList.innerHTML += row;
            });
            updateItemCounts();
        }

        // Function to format the current date
        function getCurrentDate() {
            let today = new Date();
            let day = String(today.getDate()).padStart(2, '0');
            let month = String(today.getMonth() + 1).padStart(2, '0'); // Months are zero-based
            let year = today.getFullYear();
            return `${day}/${month}/${year}`; // Return date in DD/MM/YYYY format
        }

        // Function to print only the completed items table with current date in header
        function printCompletedItems() {
            let printContent = document.querySelector('#completedItemList').parentElement.outerHTML; // Get only the table containing the completed items
            let printWindow = window.open('', '', 'height=600,width=800');
            
            let currentDate = getCurrentDate(); // Get the current date

            printWindow.document.write('<html><head><title>Print Completed Items</title>');
            printWindow.document.write('<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">');
            printWindow.document.write('</head><body>');
            printWindow.document.write(`<h4>Completed Items (as of ${currentDate})</h4>`); // Add the title with the current date to the print page
            printWindow.document.write(printContent); // Insert the table content
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print(); // Trigger the print dialog
        }

        renderCompletedItems();

        // Function to update item counts
        function getItems() {
            let items = localStorage.getItem('items');
            return items ? JSON.parse(items) : [];
        }

        function getCompletedItems() {
            let completedItems = localStorage.getItem('completedItems');
            return completedItems ? JSON.parse(completedItems) : [];
        }

        function updateItemCounts() {
            let items = getItems();
            let completedItems = getCompletedItems();
            document.getElementById("total_items_count").textContent = items.length;
            document.getElementById("total_completedItem_count").textContent = completedItems.length;
        }

        updateItemCounts();

        $(document).ready(function () {
            // Search functionality - filters the items as you type
            $('#search').on('keyup', function () {
                let searchTerm = $(this).val();
                renderCompletedItems(searchTerm);
            });
        });
    </script>
     <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- Include SweetAlert2 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- <script src="./app.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>